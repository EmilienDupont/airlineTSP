<!DOCTYPE html>
<meta charset="utf-8">
<!-- Next lines for math/latex -->
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
                      tex2jax: {inlineMath: [['$', '$'], ['\\(','\\)']]},
                      TeX: { equationNumbers: {autoNumber: "AMS"} },
                      "HTML-CSS": { showMathMenu: false,
                                    scale: 90 }

                     });
</script>

<!-- Next lines for styling (CSS) -->
<style>

rect {
  fill: none;
  pointer-events: all;
}

.node {
  fill: #000;
}

.cursor {
  fill: none;
  stroke: brown;
  pointer-events: none;
}

.link {
  stroke: #999;
}

</style>
<!-- Next lines html -->
<body>
  <!-- Navigation -->
  <ul id="nav">
    <li class="current"><a href="#intro">Intro</a></li>
    <li><a href="#problem">Problem</a></li>
    <li><a href="#model">Model</a></li>
    <li><a href="#implementation">Implementation</a></li>
    <li><a href="#demo">Live Demo</a></li>
  </ul>
  <!--Set title and write stuff-->
  <div id="container">
    <div class="section" id="intro">
      <h1>Flight Tour</h1>
        <subtitle>with integer programming and Gurobi</subtitle>
    </div>

    <div class="section" id="problem">
      <h2><a href="#problem" name="problem">Problem Description</a></h2>
      Problem description goes here
    </div>
    <div class="section" id="model">
      <h2><a href="#model" name="model">Mathematical Model</a></h2>

      <p>Model description goes here.</p>

<!-- We use tex with $ as usual-->
      
<!-- implementation (gurobi code) -->
    </div>
    <div class="section" id="implementation">
      <h2><a href="#implementation" name="implementation">Implementation</a></h2>
      <p>Below is the full implementation of the model (and the associated data) in
        Gurobi's Python interface:
      </p>
      <pre>
        from gurobipy import *

        # Change this
        
      </pre>
    </div>
    <div class="section" id="demo">
      <h2><a href="#demo" name="demo">Live Demo</a></h2>
      <!-- Where we put graphics -->
      <div id="demoarea">
      </div>
      <!-- When button is clicked => calls compute() -->
      <button onclick="compute()">Compute Tour</button>
    </div>

    <!-- Load d3 library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<!-- After script, javascript -->
<script>

var width = 960,
    height = 500;
    padding = 10;

// Create scales
var xScale = d3.scale.linear()
            .domain([0, width])
            .range([padding, width - padding]);

var yScale = d3.scale.linear()
            .domain([0, height])
            .range([height - padding, padding]);
    
var svg = d3.select("#demoarea").append("svg")
    .attr("width", width)
    .attr("height", height)
    .on("mousedown", mousedown); // mousedown is function defined below whichis executed when you click

//var map = d3.geo.albersUsa();

// Create some data (vertices of the graph here)
var nodes = [[28,100], [152,190], [400,50]];

var circles = svg.selectAll("circle") // Select all the circles (that do not yet exist...)
                 .data(nodes) // Iterate over the dataset
                 .enter() // create an object
                 .append("circle"); // actually add circles
  
  circles.attr("cx", function(d, i) { // cx is x coordinate of center // d always refers to the dataset linked to the circle // i is an index referring to each circle in dataset
            return nodes[i][0]; // i.e move x coordinate of center to the right
            })
            .attr("cy", function(d, i) { // cx is x coordinate of center // d always refers to the dataset linked to the circle // i is an index referring to each circle in dataset
            return nodes[i][1]; // i.e move x coordinate of center to the right
            })
            .attr("r", 5)
            .attr("fill", "black")
            .attr("stroke", "gray")
            .attr("stroke-width", 2);

function mousedown() {
  var point = d3.mouse(this);
  console.log(point)
  nodes.push(point);
  
  // Add new point
  var circles = svg.selectAll("circle") // Select all the circles (that do not yet exist...)
                 .data(nodes) // Iterate over the dataset
                 .enter() // create an object
                 .append("circle"); // actually add circles
  
  circles.attr("cx", function(d, i) { // cx is x coordinate of center // d always refers to the dataset linked to the circle // i is an index referring to each circle in dataset
            return nodes[i][0]; // i.e move x coordinate of center to the right
            })
            .attr("cy", function(d, i) { // cx is x coordinate of center // d always refers to the dataset linked to the circle // i is an index referring to each circle in dataset
            return nodes[i][1]; // i.e move x coordinate of center to the right
            })
            .attr("r", 5)
            .attr("fill", "black")
            .attr("stroke", "gray")
            .attr("stroke-width", 2);
}

function compute() {
  var vertices = nodes;
  for (var i = 0; i < nodes.length; i++) {
     console.log("x", nodes[i][0])
     console.log("y", nodes[i][1])
  }
  console.log('vertices', vertices);
  
  d3.json('/resource')
    .header('Content-Type', 'application/json')
    .post(JSON.stringify({'vertices': vertices}), serverResponse);
} 


function serverResponse(error, data) {
   console.log('serverResponse');
   console.log('data', data);
   if (!error) {
      if ('tour' in data) {
        var tour = data.tour;
        console.log('tour', tour);
        
        // Get list of edges of tour
        var src = tour[0];
        links = [];
        for (var i = 1; i < tour.length; i++) {
          links.push([src, tour[i]]);
          src = tour[i];
        }
        links.push([tour[tour.length-1], tour[0]]);
        
        console.log('links', links);
        
        // Draw lines between points
        var lines = svg.selectAll("line")
                        .data(links)
                        .enter()
                        .append("line");
        
        lines.style("stroke", "blue")
             .style("stroke-width", 3)
              .attr("x1", function(d,i) {
                var node1 = nodes[links[i][0]];
                var x1 = node1[0]
                return x1;
              })
              .attr("y1", function(d,i) {
                var node1 = nodes[links[i][0]];
                var y1 = node1[1]
                return y1;
              })
              .attr("x2", function(d,i) {
                var node2 = nodes[links[i][1]];
                var x2 = node2[0]
                return x2;
              })
              .attr("y2", function(d,i) {
                var node2 = nodes[links[i][1]];
                var y2 = node2[1]
                return y2;
              })
      }
   }
}

</script>
